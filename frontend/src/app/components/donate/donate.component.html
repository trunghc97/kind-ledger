<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <!-- Campaign Info -->
      <div *ngIf="campaign" class="card mb-4">
        <div class="card-body">
          <h2 class="h4 mb-3">{{ campaign.name }}</h2>
          <p class="text-muted mb-3">{{ campaign.description }}</p>
          
          <div class="row">
            <div class="col-md-6">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="fw-bold text-primary">{{ formatCurrency(campaign.raised) }}</span>
                <span class="text-muted">/ {{ formatCurrency(campaign.goal) }}</span>
              </div>
              <div class="progress mb-2" style="height: 8px;">
                <div class="progress-bar" 
                     [style.width.%]="(campaign.raised / campaign.goal) * 100"
                     [ngClass]="campaign.status === 'COMPLETED' ? 'bg-success' : 'bg-primary'">
                </div>
              </div>
              <small class="text-muted">
                {{ ((campaign.raised / campaign.goal) * 100) | number:'1.1-1' }}% hoàn thành
              </small>
            </div>
            <div class="col-md-6 text-end">
              <span class="badge" 
                    [ngClass]="campaign.status === 'COMPLETED' ? 'bg-success' : 'bg-primary'">
                {{ campaign.status === 'COMPLETED' ? 'Hoàn thành' : 'Đang mở' }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Donation Form -->
      <div class="card">
        <div class="card-header">
          <h1 class="h3 mb-0">
            <i class="fas fa-heart text-danger me-2"></i>
            Quyên góp
          </h1>
        </div>
        <div class="card-body">
          <!-- Success Message -->
          <div *ngIf="success" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            Quyên góp đã được xử lý thành công! Đang chuyển hướng...
            <div class="spinner-border spinner-border-sm ms-2" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>

          <!-- Error Message -->
          <div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            {{ error }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>

          <form [formGroup]="donationForm" (ngSubmit)="onSubmit()">
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="donorId" class="form-label">Mã nhà tài trợ *</label>
                  <input type="text" 
                         class="form-control" 
                         id="donorId" 
                         formControlName="donorId"
                         placeholder="Ví dụ: donor-001"
                         [class.is-invalid]="donationForm.get('donorId')?.invalid && donationForm.get('donorId')?.touched">
                  <div class="invalid-feedback">
                    {{ getFieldError('donorId') }}
                  </div>
                  <div class="form-text">Mã duy nhất để nhận diện nhà tài trợ</div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="donorName" class="form-label">Tên nhà tài trợ *</label>
                  <input type="text" 
                         class="form-control" 
                         id="donorName" 
                         formControlName="donorName"
                         placeholder="Ví dụ: Nguyễn Văn A"
                         [class.is-invalid]="donationForm.get('donorName')?.invalid && donationForm.get('donorName')?.touched">
                  <div class="invalid-feedback">
                    {{ getFieldError('donorName') }}
                  </div>
                </div>
              </div>
            </div>

            <div class="mb-4">
              <label for="amount" class="form-label">Số tiền quyên góp (VND) *</label>
              <div class="input-group">
                <span class="input-group-text">₫</span>
                <input type="number" 
                       class="form-control" 
                       id="amount" 
                       formControlName="amount"
                       placeholder="100000"
                       min="10000"
                       [class.is-invalid]="donationForm.get('amount')?.invalid && donationForm.get('amount')?.touched">
                <div class="invalid-feedback">
                  {{ getFieldError('amount') }}
                </div>
              </div>
              <div class="form-text">Số tiền tối thiểu: {{ formatCurrency(10000) }}</div>
            </div>

            <div class="d-flex gap-2">
              <button type="submit" 
                      class="btn btn-success btn-lg"
                      [disabled]="loading || donationForm.invalid || (campaign && campaign.status === 'COMPLETED')">
                <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" role="status">
                  <span class="visually-hidden">Loading...</span>
                </span>
                <i *ngIf="!loading" class="fas fa-heart me-2"></i>
                {{ loading ? 'Đang xử lý...' : 'Quyên góp ngay' }}
              </button>
              <button type="button" 
                      class="btn btn-outline-secondary"
                      [routerLink]="['/campaigns', campaignId]">
                <i class="fas fa-arrow-left me-2"></i>
                Quay lại
              </button>
            </div>

            <div *ngIf="campaign && campaign.status === 'COMPLETED'" class="alert alert-info mt-3">
              <i class="fas fa-info-circle me-2"></i>
              Chiến dịch này đã hoàn thành và không nhận quyên góp nữa.
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
